name: Update Readme.md

on:
    push:
        paths:
            - ".github/scripts/update-readme.js"
            - ".github/workflows/readme.yml"
        branches:
            - main
    schedule:
        - cron: "0 18 * * *"
    workflow_dispatch:

permissions:
    contents: write

jobs:
    update-repo-list:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "22"

            - name: Install dependencies
              run: |
                  echo '{"name":"readme-updater","private":true}' > package.json
                  npm install @octokit/rest

            - name: Fetch repositories and generate files
              env:
                  ORG_NAME: amoga-org
              run: node .github/scripts/update-readme.js

            - name: Commit and push changes
              run: |
                  git config --global user.name "[bot]GitHub Action"
                  git config --global user.email "github-actions[bot]@users.noreply.github.com"                  
                  git add .
                  if git diff --staged --quiet; then
                    echo "No changes to commit"
                  else
                    git commit -m "Auto-update repository list and README"
                    git push
                  fi
